---
title: "The tall tale of violence"
output: github_document
---

### El relat de la violència

```{r setup, include=FALSE, echo = FALSE}
# Basic knitr options
library(knitr)
opts_chunk$set(comment = NA, 
               echo = FALSE, 
               warning = FALSE, 
               message = FALSE, 
               error = TRUE, 
               cache = FALSE,
               fig.path = 'figures/')
```


```{r}
# Libraries
library(vilaweb)
library(rtweet)
library(tidyverse)
library(databrew)
```

```{r, eval = TRUE}
# Set up
source('get_data.R')
# There is now an object named tl, with all tweets
# Ensure no duplicates
tl <- tl %>% dplyr::distinct(.keep_all = TRUE)
```


```{r}
# # Read temp data <-
# out_list <- list()
# peeps <- dir('data')
# # peeps <- gsub('_tweets', '', peeps)
# for(i in 1:length(peeps)){
#   peep <- peeps[i]
#   dat <- read_csv(paste0('data/', peep, '/tweets.csv'))
#   out_list[[i]] <- dat
# }
# tl <-bind_rows(out_list)

# Filter out low-posters
removers <- c('eva_granados',
              'carmencalvo_',
              'meritxell_batet')

# Flag the violence posts
tl <- tl %>%
  filter(!username %in% removers) %>%
  # Only keep those who have posts going back to Sep 2017
  group_by(username) %>%
  filter(min(date) <= '2017-09-01') %>%
  ungroup %>%
  # Identify violence posts, but filter out the violencia de genero ones
  mutate(violence = grepl('violen', tolower(tweet))) %>%
  mutate(genero = grepl('machis|masclis|mujer|dona|done|géner|gèner|genero|marido|marit|novio|esposa|novia|doméstic|domèstic', tolower(tweet))) %>%
  mutate(violence_not_genero = violence & !genero) %>%
  mutate(tumultos = grepl('tumult', tolower(tweet))) %>%
  # Flag the newspaper posts
  mutate(newspaper = tolower(username) %in% tolower(c(
    'ElMundoEspana',
    'elpais_espana',
    'LaVanguardia',
    'cronicaglobal',
    'elespanolcom',
    'elperiodico',
    'elconfidencial',
    'OKDIARIO',
    'enoticiescat'))) %>%
  mutate(party = tolower(username) %in% tolower(c(
            'PSOE',
            'socialistes_cat',
            'CiutadansCs',
            'PPopular',
            'PPCatalunya',
            'vox_es',
            'CiudadanosCs',
            'Societatcc'))) %>%
  mutate(type = ifelse(newspaper, 'Newspaper', 
                       ifelse(party, 'Party/group',
                              'Person')))




# By time
bt <- 
  tl %>%
  mutate(year_month = date_truncate(date, level = 'week')) %>%
  group_by(type, date = year_month, 
           person = username) %>%
  summarise(n = length(which(violence_not_genero)),
            d = n()) %>%
  ungroup %>%
  mutate(p = n / d * 100) %>%
  filter(date >= '2017-08-01',
         date <= '2018-07-31')

# Aggregate too
agg <- bt %>%
  group_by(date) %>%
  summarise(n = sum(n)) %>%
  ungroup
agg_type <- bt %>%
  group_by(date, type) %>%
  summarise(n = sum(n)) %>%
  ungroup

# Define the important labels
label_df <-
  data_frame(date = as.Date(c('2017-09-20',
                              '2017-10-01',
                              # '2017-10-17',
                              '2017-10-27',
                              # '2017-11-02',
                              '2017-12-21',
                              '2018-03-25',
                              # '2018-07-20',
                              '2018-10-01')),
             label_ca = c('20-S',
                       '1-O',
                       # 'Jordis entren a la presó',
                       '155',
                       # 'Ministres a la presó',
                       'Eleccions',
                       'Puigdemont detingut',
                       # 'Llarena cancela\nordres de detenció',
                       'Manifestacions al Parlament'),
             label_en = c('20-S',
                       '1-O',
                       # 'Jordis imprisoned',
                       # 'Ministers imprisoned',
                       '155',
                       'Elections',
                       'Puigdemont arrested',
                       # 'Llarena cancels\narrest warrants',
                       'Protests at Parlament')) %>%
  mutate(label = label_en) %>%
  mutate(date_merge = date_truncate(date, 'week')) %>%
  mutate(y = ((1:length(label_ca)) %% 2 * -1)-1) %>%
  mutate(yend = -0.5) %>%
  filter(date <= max(bt$date))

# ggplot(data = bt,
#        aes(x = date,
#            y = n)) +
#   geom_bar(stat = 'identity',
#            width = 7) +
#     facet_wrap(~person)
```

## The question

#### Was there a violent rebellion in Catalonia in September and October of 2017?

9 Catalan social and political leaders are currently in pre-trial prison for their involvement in organizing and promoting an independence referendum last autumn. They are being charged by the State with rebellion, a crime which, [by definition in the Spanish Penal Code](https://www.legislationline.org/download/action/download/id/6443/file/Spain_CC_am2013_en.pdf), requires violence. But are the imprisoned leaders violent rebels? Or are the charges a fabrication meant to halt the independence movement by means of decapiting its leadership through long, exemplary jail sentences .

## The hypothesis

#### If violence took place, then politicians will have talked about it.

If there was indeed a violent uprising or violent rebellion in Catalonia in September and October of 2017, we would expect that Catalan and Spanish politicians, particularly those most opposed to indepenence, will have noticed, talked, and tweeted about the violence. Let's take a look at twitter data from the period of the supposed violent uprising, and see who was talking about violence.

## The data

We examined tweets from the year beginning in August 2017. We limited our analysis to individuals and groups which are most opposed to the Catalan independence movement, since these accounts were most likely to discuss the supposed violence of independentists. In total, our analysis covered `r sum(bt$d)` tweets from `r length(unique(bt$person))` twitter accounts.

## The results

### Tweets from politicians and parties

The below chart shows all tweets containing the words violence/violent during the time period in question (excluding tweets algorithmically identified as being specific to gender violence).

```{r, fig.height=6}
# PEOPLE/PARTY PLOT
plot_data <- bt %>% filter(type %in% c('Person', 'Party/group'))
gapper <- max(agg_type$n[agg_type$type %in% c('Person', 'Party/group')]) / 10
date_breaks <- sort(unique(plot_data$date))
plot_data$person<- paste0('@', plot_data$person)
ggplot(data = plot_data,
       aes(x = date,
           y = n)) +
  geom_bar(stat = 'identity',
           aes(group = person,
           fill = person),
           width = 7) +
  theme_vilaweb() +
  labs(title = 'Tweets containing the word "violence"*',
       subtitle = 'August 2017-July 2018',
       caption = '*Removed tweets identified as being specific to gender violence: "machista, masclisme, mujer, dona, género, marido, etc.".\n*A tweet was flagged as containing the word "violence" if it contained the sub-string "violen", ie "violencia", "violentos"...\nBlack line smoothed via local regression. Data extracted/processed and chart created on 5 December 2018. Joe Brew. @joethebrew.',
       x = 'Week',
       y = 'Tweets') +
  geom_text(data = label_df,
             aes(x = date,
                 y = (gapper*y)-(gapper * 0.5),
                 label = label),
            alpha = 0.6,
            size = 4) +
  geom_point(data = label_df,
             pch = '',
             aes(x = date,
                 y = label_df$yend[1])) +
  scale_fill_manual(name = '',
                    values = databrew::make_colors(n = length(unique(plot_data$person)))) +
  geom_line(stat = 'smooth', method = 'auto',
            # formula = y ~ poly(x, 1),
            size = 1, alpha = 0.8,
            data = agg_type %>% filter(type %in% c('Person', 'Party/group')) %>%
              group_by(date) %>%
              summarise(n = sum(n)) %>%
              ungroup,
              aes(x = date,
                  y = n)) +
  geom_path(data = label_df %>% mutate(y = y * gapper) %>% gather(key, value, y:yend),
               aes(x = date,
                   y = value,
                   group = date),
            alpha = 0.6) +
  guides(fill = guide_legend(ncol = 4)) +
  theme(axis.text.x = element_text(size = 13),
        plot.caption = element_text(size = 7),
        plot.subtitle = element_text(size = 16),
        plot.title = element_text(size = 20),
        legend.text = element_text(size = 10)) +
  geom_bar(data = agg_type %>% filter(type %in% c('Person', 'Party/group')) %>%
             group_by(date)%>%
             summarise(n = sum(n)),
           stat = 'identity',
           width = 7,
           fill = NA,
           color = 'black',
           lwd = 0.3)
```

It is clear in the above chart that tweets about "violence" did not spike during the supposed violent events. Anti-independence politicians did not mention violence in the immediate aftermath of "violent uprising". 

For example, the Partido Popular made no mentions of "violence" during the 3 days following the September 20th protest for which "the Jordis" are now imprisoned. However, on September 24th, they - along with now Spanish President Pedro Sánchez (who also made no mentions of the "violence" of September 20th) - tweeted about an unrelated assault in Zaragoza:

<table style="width:100%">
  <tr>
    <td><img src="img/pp.png" /></td>
    <td><img src="img/sanchez.png" /></td>
  </tr>
</table>

Why condemn the "violence" of an assault in Zaragoza, but not of a rebellion in Catalonia?



On the day after the "violent uprising" of September 20th, Inés Arrimadas tweeted about budgets, World Alzheimer day, the fight against corruption - but no mention of violence. Xavier García Albiol tweeted about the Espanyol football team, and the 17th anniversary of the assassination of José Luis Ruiz Casado by ETA - but no mention of the "violence" the previous night.

Rather, the peak in tweets mentioning the word violence did not occur until late March and April of 2018 - precisely the time at which Puigdemont was detained in Germany. The increase in tweets about violence remained high for several weeks during Puigdemont's detention. For example, Albert Rivera, whose only tweet mentioning the term "violence" in September and October 2017 (the period of the supposed violent rebellion) pertained to [gender violence](https://twitter.com/Albert_Rivera/status/913379945455538176), tweeted several articles associating violence and Catalan nationalism.

<table style="width:100%">
  <tr>
    <td><img src="img/rivera3.png" /></td>
    <td><img src="img/rivera2.png" /></td>
  </tr>
</table>





### Tweets about violence from newspapers

Newspapers followed a similar trend, albeit with more emphasis on violence in September and October of 2017. However, nearly all coverage of September/October 2017 violence by newspapers was of violence carried out _by the State_, not against the State. For example, of the 16 articles on October 2 published by El País, El Confidencial, El Español, El Mundo and El Periódico with the term "violence", 0 referred to violence carried out by the pro-independence camp; all 16 referred to police violence.

Nonetheless, the peak in the term "violence" in newspaper tweets did not come during the supposed violent rebellion, but in late March / early April 2018, at the time of the Puigdemont arrest. 

```{r}
# Newspaper plot
plot_data <- bt %>% filter(type == 'Newspaper')
plot_data$person<- paste0('@', plot_data$person)

gapper <- max(agg_type$n[agg_type$type == 'Newspaper']) / 15
date_breaks <- sort(unique(plot_data$date))
ggplot(data = plot_data,
       aes(x = date,
           y = n)) +
  geom_bar(stat = 'identity',
           aes(group = person,
           fill = person),
           width = 7) +
  theme_vilaweb() +
  labs(title = 'Tweets containing the word "violence"*',
       subtitle = 'August 2017-December 2018',
       caption = '*Removed tweets identified as being specific to gender violence: "machista, masclisme, mujer, dona, género, gènere".\n*A tweet was flagged as containing the word "violence" if it contained the sub-string "violen", ie "violencia", "violentos", etc.\nBlack line smoothed via local regression. Data extracted on 5 December 2018. Joe Brew. @joethebrew.',
       x = 'Week',
       y = 'Tweets') +
  geom_text(data = label_df,
             aes(x = date,
                 y = (gapper*y)-(gapper * 0.5),
                 label = label),
            alpha = 0.6,
            size = 4) +
  geom_point(data = label_df,
             aes(x = date,
                 y = label_df$yend[1])) +
  scale_fill_manual(name = '',
                    values = databrew::make_colors(n = length(unique(plot_data$person)))) +
  geom_line(stat = 'smooth', method = 'auto', 
            # formula = y ~ poly(x, 1),
            size = 1, alpha = 0.8,
            data = agg_type %>% filter(type == 'Newspaper'),
              aes(x = date,
                  y = n)) +
  geom_path(data = label_df %>% mutate(y = y * gapper) %>% gather(key, value, y:yend),
               aes(x = date,
                   y = value,
                   group = date),
            alpha = 0.6) +
  guides(fill = guide_legend(ncol = 3)) +
  theme(axis.text.x = element_text(size = 13),
        plot.caption = element_text(size = 7),
        plot.subtitle = element_text(size = 16),
        plot.title = element_text(size = 20),
        legend.text = element_text(size = 10)) +
  geom_bar(data = agg_type %>% filter(type == 'Newspaper'),
           stat = 'identity',
           width = 7,
           fill = NA,
           color = 'black',
           lwd = 0.3)
```

### The curious case of Ciudadanos and Societat Civil Catalana

In the above we've seen that tweets about violence largely occurred many months _after_ the supposed violent rebellion for which Catalan political leaders are being charged. If there is any one party which best encapsulates this trend it is Ciudadanos. Both its leaders and official accounts wrote rarely or never about violence during the "rebellion", but began mentioning violence with a significantly higher frequency beginning in the spring of 2018. Societat Civil Catalana, a pro-union advocacy group, had a very similar frequency of violence-related tweets.

```{r}
gapper <- 0.2

label_df <- label_df %>%
  filter(!grepl('llarena', tolower(label_ca)))
ggplot(data = bt %>%
         filter(person %in% c('albert_rivera', 'carrizosacarlos', 'ciutadanscs',
                                'inesarrimadas', 'ciudadanoscs', 'societatcc')) %>%
         mutate(person = paste0('@', person)),
       aes(x = date,
           y = n)) +
  geom_bar(stat = 'identity',
           width = 7,
           fill = 'darkorange',
           alpha = 0.6,
           color = 'black',
           lwd = 0.2) +
  facet_wrap(~person, scales = 'free_y') +
  geom_text(data = label_df,
             aes(x = date,
                 y = (gapper*y)-(gapper * 0.5),
                 label = label),
            alpha = 0.6,
            size = 2) +
  geom_point(data = label_df,
             pch = '',
             aes(x = date,
                 y = label_df$yend[1])) +
  
  geom_path(data = label_df %>% mutate(y = y * gapper) %>% gather(key, value, y:yend),
               aes(x = date,
                   y = value,
                   group = date),
            alpha = 0.6) +
  theme_vilaweb() +
   labs(title = 'Tweets containing the word "violence"*',
       subtitle = 'August 2017-July 2018',
       caption = '*Removed tweets identified as being specific to gender violence: "machista, masclisme, mujer, dona, género, marido, etc.".\n*A tweet was flagged as containing the word "violence" if it contained the sub-string "violen", ie "violencia", "violentos"...\nBlack line smoothed via local regression. Data extracted/processed and chart created on 5 December 2018. Joe Brew. @joethebrew.',
       x = 'Week',
       y = 'Tweets') +
  scale_y_continuous(breaks = seq(0, 20, 2)) +
  theme(axis.text.x = element_text(size = 8)) +
  scale_x_date(labels = function(x){format(x, '%b\n%Y')}) +
    geom_line(stat = 'smooth', method = 'auto', 
            # formula = y ~ poly(x, 1),
            size = 1, alpha = 0.5,
              aes(x = date,
                  y = n)) 
```


## Qualitative interpretation

Is Twitter the objective arbiter of reality? Of course not. But it is still useful. 

Among pro-union politicians, political parties, and newspapers, the frequency of the word "violence" was relatively low during the supposed "violent" rebellion of Catalonia, and has increased over time. Whereas virtually no pro-union politicians mentioned violence during and immediately after the events for which Catalan independence leaders are now being charged with crimes, many began to mention the term with increasing frequency during 2018.

One cannot examine these data without at least asking the question: If there was really a violent rebellion, why did nobody talk about it until much later?

The data only tell us what was said on twitter, not why. But the political reality helps one to make some conclusions. In the days surrounding the Catalan self-determination referendum, the anti-independence actors had not coalesced around one strategy. The initial tactic of simply preventing the referendum by confiscating materials failed; then, trying to scare voters from casting a ballot also failed. The independence movement, in early October, appeared unstoppable.

Finally, a strategy emerged: "behead" independence leadership through preventive, exemplary imprisonment. The strategy was initially effective insofar as it threw the independence movement into disarray and effectively silenced many of its protagonists. However, it was unsustainable: jailing politicians and preventing them from exercising their elected office is not permitted in democracies. Unless, of course, those politicians are guilty of blood crimes.

When one understands this - that the accusation of violence is not based on reality, but rather on a political strategy - than the fact that the tweet-trail about violence does not correspond with reality should come as no surprise. Anti-independence politicians did not tweet about pro-independence violence in September and October of 2017 for one simple reason: there was none. 

When it became apparent that judicializing the political conflict was an effective means to take momentum away from the independence movement, a convenient narrative emerged. The tale of pro-independence violence was so fantastical - so unbelievable - at first that it did not fully cement itself into the political paradigm until months later, reaching its peak in the spring during the extradition proceedings for Carles Puigdemont. Now the tale has been told enough times that it has simply become dogma for many.

One of the benefits of living in the era of "big data" is that we can look back on things as they were, and not simply as we remember them. On the morning of September 21st, the day after the "violent uprising" lead by Jordi Sánchez and Jordi Cuixart, their political opponents woke up, read the news, and tweeted about many things. But not about violence. 

And on the morning of October 2nd, the day after the "violent rebellion" for which nearly a dozen Catalan leaders are currently in prison or exile, Andrey Levy wrote about "sentimental rupture" - not violence. Inés Arrimadas tweeted about the "failure" of the referendum - not about violence. Albert Rivera wrote about the need for elections - not about violence. Miquel Iceta retweeted articles about the ineptitude of Rajoy - not about the violence of those who wanted to vote on independence.

Maybe the increase in tweets about the "violence" of Catalan independence leaders did not come until so much later because that's how long it took to forget what had really happened.

Fortunately, we have data to help us remember the truth.


### Technical details

All of the code for this analysis is open-source and available at https://github.com/joebrew/vilaweb.

Follow Joe Brew on twitter at @joethebrew.



